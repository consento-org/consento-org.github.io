<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Consento Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Consento Blog Atom Feed"><title data-react-helmet="true">Timestamp synchronization | Consento</title><meta data-react-helmet="true" property="og:url" content="https://consento.org/docs/time"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Timestamp synchronization | Consento"><meta data-react-helmet="true" name="description" content="State: done] → [consento-org/hlc"><meta data-react-helmet="true" property="og:description" content="State: done] → [consento-org/hlc"><link data-react-helmet="true" rel="shortcut icon" href="/img/consento/cc-by-nc-nd/logo/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://consento.org/docs/time"><link data-react-helmet="true" rel="alternate" href="https://consento.org/docs/time" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://consento.org/docs/time" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.d366e330.css">
<link rel="preload" href="/assets/js/runtime~main.4ae2fa68.js" as="script">
<link rel="preload" href="/assets/js/main.7a3115da.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/consento/cc-by-nc-nd/logo/consento-with-text.png" alt="Consento Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/consento/cc-by-nc-nd/logo/consento-with-text.png" alt="Consento Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Consento</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/about">About</a><a class="navbar__item navbar__link" href="/docs/overview">Documentation</a><a class="navbar__item navbar__link" href="/usecases">Use cases</a><a class="navbar__item navbar__link" href="/team">Team</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link navbar__button" href="/download">Download</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/consento/cc-by-nc-nd/logo/consento-with-text.png" alt="Consento Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/consento/cc-by-nc-nd/logo/consento-with-text.png" alt="Consento Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Consento</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/about">About</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/overview">Documentation</a></li><li class="menu__list-item"><a class="menu__link" href="/usecases">Use cases</a></li><li class="menu__list-item"><a class="menu__link" href="/team">Team</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link navbar__button" href="/download">Download</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Overview</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/overview">What is Consento</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/how">How does Consento work?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/who">Who is Consento for?</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Consento Core</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/passwordless">Passwordless</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/sharedaccess">Shared Access Control</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/cloudfree">Cloudfree</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/shamir">Shamir&#x27;s Secret Sharing</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Building Blocks</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/time">Timestamp synchronization</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bit">Private Information Lookup and Filter</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/book">Address Books</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dcurl">Decentralized Resource Interface</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/email">Federated Email Verifcation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/group">Decentralized Groups</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/notification">Decentralized Notification System</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/vocabulary">Consento Vocabulary</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/faq">FAQ</a></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Timestamp synchronization</h1></header><div class="markdown"><p>[State: done] → <a href="https://github.com/consento-org/hlc" target="_blank" rel="noopener noreferrer">consento-org/hlc</a></p><blockquote><p><strong>TLDR;</strong> The local time of devices is not 100% in sync. Using timeservers requires a working internet connection and becomes a point of centralization. Vector clocks dont store a human readable time. The hybrid logical clock allows to have sorted, human readable time stamps for that are practically in-sync.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="background"></a>Background<a class="hash-link" href="#background" title="Direct link to heading">#</a></h2><p>We need to have timestamps for any operation done with consento. These timestamps are relevant for log auditing and to make sure that operations done on two devices get processed in the correct order on sync.</p><p>The timestamps on devices can be changed and out-of-sync and as such are not reliable. Which is why we had to explore other solutions for this.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="why-not-trusted-timestamps"></a>Why not trusted timestamps?<a class="hash-link" href="#why-not-trusted-timestamps" title="Direct link to heading">#</a></h2><p>Trusted timestamps, as described in <a href="https://www.ietf.org/rfc/rfc3161.txt" target="_blank" rel="noopener noreferrer">RFC3161</a>, work well to make sure that entries are signed at a certain timestamp; but those take time to compute, require a persistent internet connection, and an outside service and what is more: an authority trusted by all parties involved to sign those entries.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="enter-hybrid-logical-clocks"></a>Enter Hybrid Logical Clocks<a class="hash-link" href="#enter-hybrid-logical-clocks" title="Direct link to heading">#</a></h2><p>A hybrid logical clock (hlc) is a clock based on the devices clock. If no sync happens it will always just use the local device time.</p><p>What makes it different from the device clock is that it will change the internal behavior if it encounters a timestamp created by another device that is in the future.</p><p>In this case, the hlc will use the latest received timestamp and start a logical counter that increments every time a new timestamp is requested.</p><p>(thanks <a href="https://github.com/urbien" target="_blank" rel="noopener noreferrer">Gene</a> who highlighed the <a href="http://muratbuffalo.blogspot.com/2014/07/hybrid-logical-clocks.html" target="_blank" rel="noopener noreferrer">hybrid logical clock</a> and their use of it in <a href="https://github.com/tradle/multi-hyperbee" target="_blank" rel="noopener noreferrer">multi-hyperbee</a>)</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="implementation"></a>Implementation<a class="hash-link" href="#implementation" title="Direct link to heading">#</a></h2><p><a href="https://www.cockroachlabs.com/" target="_blank" rel="noopener noreferrer">CockroachDB</a> has a quite <a href="https://github.com/cockroachdb/cockroach/blob/663fcf17cb8789a2c46a719e0107a15400eee918/pkg/util/hlc/hlc.go" target="_blank" rel="noopener noreferrer">strong implementation</a> of a hlc in go-lang but we needed a JavaScript variant, working within the hypercore ecosystem.</p><p>To make sure that there is the lowest possible chance of equal timestamps, we have created <a href="https://github.com/consento-org/bigint-time" target="_blank" rel="noopener noreferrer">bigint-time</a> which will return the current time in nanoseconds.</p><p>And we published <a href="https://github.com/consento-org/hlc" target="_blank" rel="noopener noreferrer">@consento/hlc</a> that basically functions as the example below and can be reused for any sort of timestamp-syncing mechanism.</p><p><em>(Note: the configuration is rather complex, please refer to the documenation!)</em></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">HLC</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@consento/hlc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> hlc </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">HLC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Every new timestamp is used to make sure that the</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// local clock</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// is always ahead of previous timestamps.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">onNewTimestamp</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">otherDeviceTimestamp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  hlc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">update</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">otherDeviceTimestamp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> list </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">list</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">hlc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">now</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/consento-org/consento-org.github.io/edit/main/docs/time.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-05-19T08:39:54.000Z" class="lastUpdatedDate_1WI_">5/19/2021</time> by <strong>marcchataigner</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/shamir"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Shamir&#x27;s Secret Sharing</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/bit"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Private Information Lookup and Filter »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#background" class="table-of-contents__link">Background</a></li><li><a href="#why-not-trusted-timestamps" class="table-of-contents__link">Why not trusted timestamps?</a></li><li><a href="#enter-hybrid-logical-clocks" class="table-of-contents__link">Enter Hybrid Logical Clocks</a></li><li><a href="#implementation" class="table-of-contents__link">Implementation</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://keybase.io/team/consento" target="_blank" rel="noopener noreferrer" class="footer__link-item">Keybase</a></li><li class="footer__item"><a href="https://twitter.com/consentoorg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a class="footer__link-item" href="/supporters">Supporters</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Develop</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/consento-org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github Repository</a></li><li class="footer__item"><a href="https://keybase.io/team/consento" target="_blank" rel="noopener noreferrer" class="footer__link-item">Keybase Chat</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/time">Building Blocks</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/overview">Documentation</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">About</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/team">Team</a></li><li class="footer__item"><a class="footer__link-item" href="/about">About</a></li><li class="footer__item"><a class="footer__link-item" href="/jp">コンセントについて</a></li><li class="footer__item"><a class="footer__link-item" href="/usecases">Use cases</a></li></ul></div></div><div class="footer__eu-funding"><div><a href="https://ledgerproject.eu/" target="_blank"><img src="/img/external/fair-use/ngi-white@2x.png" alt="NGI Ledger"></a></div><p>This project has received funding from the European Union’s <a href="https://ec.europa.eu/programmes/horizon2020/" target="_blank">Horizon 2020</a> research and innovation programme within the framework of the <a href="https://www.ngi.eu/about/ledger/" target="_blank">LEDGER Project</a> funded under grant agreement <a href="https://cordis.europa.eu/project/id/825268" target="_blank">No825268</a>.</p><div><a href="https://ec.europa.eu/info/" target="_blank"><img src="/img/external/fair-use/eu-flag-low.png" alt="EU"></a></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2021 Consento - All rights reserved - <a href="/credits">Credits</a> - <a href="/privacy-policy">Privacy Policy</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.4ae2fa68.js"></script>
<script src="/assets/js/main.7a3115da.js"></script>
</body>
</html>